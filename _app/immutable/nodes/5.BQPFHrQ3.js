import{a as l,f as m,c as it}from"../chunks/_V9dK3ok.js";import{o as ke}from"../chunks/1hPTKaIJ.js";import{p as Se,b as q,d as vt,a as $e,c as a,e as b,g as t,s as v,r as e,h as gt,t as I,f as U}from"../chunks/CcVkWGgp.js";import{d as qe,s as f}from"../chunks/Dap9sqf4.js";import{i as w}from"../chunks/BSGnc2-w.js";import{e as Gt,i as Ht}from"../chunks/GjfVCmik.js";import{a as K,r as Jt,b as Me,c as Le,s as Tt}from"../chunks/By8uYFO7.js";import{s as pt}from"../chunks/DObsSMuQ.js";import{s as Ie,a as Ee}from"../chunks/Dn1l8nLM.js";import{p as Ce}from"../chunks/Bj2msYx7.js";import{g as Pe}from"../chunks/D2NXRMxL.js";import{b as Te}from"../chunks/CF79ULPM.js";import{a as E}from"../chunks/DfGni5YV.js";import{i as je}from"../chunks/3jTL0Oy-.js";import{Q as Kt,S as jt}from"../chunks/DqiXTygU.js";import{L as Ae}from"../chunks/Crjibkup.js";var De=m('<div class="flex items-center justify-between"><div><h1 class="text-2xl font-bold text-gray-800"> </h1> <div class="flex gap-2 mt-1 text-sm"><span class="px-2 py-0.5 bg-blue-50 text-blue-700 rounded"> </span> <span class="text-gray-400"> </span> <span class="text-gray-400"> </span></div></div></div>'),Ne=m('<div class="text-center py-12 text-gray-500"><p class="mb-4">학생 명단을 불러오는 중...</p> <p class="text-sm">잠시만 기다려주세요.</p></div>'),Qe=m('<span class="ml-2 text-orange-600 font-medium"> </span>'),Re=m('<div class="p-4 text-center text-gray-500 text-sm">활성 학생이 없습니다.</div>'),Ue=m("<button> </button>"),Be=m('<input type="number" class="w-20 px-2 py-1 text-center border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"/>'),Fe=m('<span class="inline-block w-2 h-2 rounded-full bg-orange-400" title="변경됨"></span>'),Oe=m('<span class="inline-block w-2 h-2 rounded-full bg-green-400" title="채점 완료"></span>'),Ye=m('<span class="inline-block w-2 h-2 rounded-full bg-gray-300" title="미제출"></span>'),ze=m('<span class="inline-block w-2 h-2 rounded-full bg-yellow-400" title="미채점"></span>'),Ge=m('<tr><td class="px-4 py-2.5 text-sm text-gray-400"></td><td class="px-4 py-2.5 text-sm font-medium text-gray-800"> </td><td class="px-4 py-2.5 text-center"><!></td><td class="px-4 py-2.5 text-center"><label class="inline-flex items-center cursor-pointer"><input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer"/></label></td><td class="px-4 py-2.5 text-center"><!></td><td class="px-4 py-2.5 text-center"><button class="px-2 py-1 text-xs rounded border transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed border-red-200 text-red-600 hover:bg-red-50"> </button></td></tr>'),He=m('<div class="bg-white rounded-lg border border-gray-200 overflow-hidden"><div class="overflow-x-auto"><table class="w-full min-w-[700px]"><thead><tr class="bg-gray-50 border-b border-gray-200"><th class="text-left px-4 py-3 text-sm font-medium text-gray-600 w-12">#</th><th class="text-left px-4 py-3 text-sm font-medium text-gray-600">학생</th><th class="text-center px-4 py-3 text-sm font-medium text-gray-600 w-32">점수</th><th class="text-center px-4 py-3 text-sm font-medium text-gray-600 w-24">제출</th><th class="text-center px-4 py-3 text-sm font-medium text-gray-600 w-20">채점</th><th class="text-center px-4 py-3 text-sm font-medium text-gray-600 w-24">상태</th></tr></thead><tbody></tbody></table></div></div>'),Je=m('<div class="sticky bottom-2 sm:bottom-4 mt-4"><div class="bg-orange-50 border border-orange-200 rounded-lg px-4 py-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 shadow-lg"><span class="text-sm text-orange-700 font-medium"> </span> <button class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 disabled:opacity-50 transition-colors cursor-pointer"> </button></div></div>'),Ke=m('<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4"><div class="text-sm text-gray-500"> <!></div> <div class="flex gap-2"><button class="px-4 py-1.5 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors cursor-pointer"> </button></div></div> <!> <!>',1),Ve=m('<div class="p-4 text-center text-gray-500 text-sm">비활성 학생이 없습니다.</div>'),We=m('<tr class="border-b border-gray-100 last:border-b-0 bg-gray-50/50"><td class="px-4 py-2.5 text-sm text-gray-400"></td><td class="px-4 py-2.5 text-sm text-gray-500"> </td><td class="px-4 py-2.5 text-center"><button class="px-2 py-1 text-xs rounded border transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed border-green-200 text-green-600 hover:bg-green-50"> </button></td></tr>'),Xe=m('<div class="bg-white rounded-lg border border-gray-200 overflow-hidden"><div class="overflow-x-auto"><table class="w-full"><thead><tr class="bg-gray-50 border-b border-gray-200"><th class="text-left px-4 py-3 text-sm font-medium text-gray-600 w-12">#</th><th class="text-left px-4 py-3 text-sm font-medium text-gray-600">학생</th><th class="text-center px-4 py-3 text-sm font-medium text-gray-600 w-24">상태</th></tr></thead><tbody></tbody></table></div></div>'),Ze=m('<div class="flex border-b border-gray-200 mb-4"><button> </button> <button> </button></div> <!>',1),tr=m('<div class="max-w-4xl mx-auto px-3 py-6 sm:px-6"><div class="mb-6"><button class="text-sm text-blue-600 hover:text-blue-800 mb-2 cursor-pointer">&larr; 퀘스트 목록</button> <!></div> <!></div>');function mr(Vt,Wt){Se(Wt,!0);const Xt=()=>Ee(je,"$isLoggedIn",Zt),[Zt,te]=Ie();let bt=q(!0),j=q(!1),g=q(null),S=q(vt([])),V=gt(()=>Ce.params.questId),At=q(!1),W=q("active"),B=q(vt([])),F=q(null),d=q(vt(new Map)),A=q(vt(new Map)),X=gt(()=>t(g)?jt[t(g).quest_type]:jt.main),Dt=gt(()=>()=>{for(const[s,r]of t(d)){const i=t(A).get(s);if(!i||r.score!==i.score||r.is_submitted!==i.is_submitted)return!0}return!1}),mt=gt(()=>()=>{let s=0;for(const[r,i]of t(d)){const u=t(A).get(r);(!u||i.score!==u.score||i.is_submitted!==u.is_submitted)&&s++}return s});ke(async()=>{if(!Xt()){Pe(`${Te}/login`);return}await Nt()});async function Nt(){b(bt,!0);try{const[s,r]=await Promise.all([E.get(`/api/v1/facilitator/quests/${t(V)}`),E.get(`/api/v1/facilitator/quests/${t(V)}/students`)]);if(b(g,s,!0),b(S,r,!0),xt(),t(g)&&ee(),t(S).length===0&&t(g)&&!t(At)){b(At,!0);try{await E.post(`/api/v1/admin/sync/students/${t(g).cached_course_id}`);const i=await E.get(`/api/v1/facilitator/quests/${t(V)}/students`);b(S,i,!0),xt()}catch{}}}catch{K("점수 데이터를 불러올 수 없습니다.","error")}finally{b(bt,!1)}}async function ee(){if(t(g))try{b(B,await E.get(`/api/v1/facilitator/courses/${t(g).cached_course_id}/students?active=false`),!0)}catch{}}function xt(){const s=new Map,r=new Map;for(const i of t(S)){const u={score:i.score,is_submitted:i.is_submitted};s.set(i.legacy_student_id,{...u}),r.set(i.legacy_student_id,{...u})}b(d,s,!0),b(A,r,!0)}function Qt(s,r){const i=t(d).get(s);if(i){if(r===""||r===null||r===void 0)i.score=null;else{const u=parseFloat(r);isNaN(u)||(i.score=Math.min(Math.max(u,t(X).min),t(X).max))}b(d,new Map(t(d)),!0)}}function re(s){const r=t(d).get(s);r&&(r.is_submitted=!r.is_submitted,r.is_submitted||(r.score=null),b(d,new Map(t(d)),!0))}async function Rt(s){if(t(g)){b(F,s,!0);try{const r=await E.patch(`/api/v1/facilitator/courses/${t(g).cached_course_id}/students/${s}/active`);K(r.is_active?"학생이 활성화되었습니다.":"학생이 비활성화되었습니다.","success");const[i,u]=await Promise.all([E.get(`/api/v1/facilitator/quests/${t(V)}/students`),E.get(`/api/v1/facilitator/courses/${t(g).cached_course_id}/students?active=false`)]);b(S,i,!0),b(B,u,!0),xt()}catch{K("학생 상태 변경에 실패했습니다.","error")}finally{b(F,null)}}}async function Ut(){b(j,!0);try{const s=[];for(const[r,i]of t(d)){const u=t(A).get(r);(!u||i.score!==u.score||i.is_submitted!==u.is_submitted)&&s.push({legacy_student_id:r,score:i.is_submitted?i.score:null,is_submitted:i.is_submitted})}if(s.length===0){K("변경된 점수가 없습니다.","info"),b(j,!1);return}await E.post(`/api/v1/facilitator/quests/${t(V)}/scores`,{scores:s}),K(`${s.length}명의 점수가 저장되었습니다.`,"success"),await Nt()}catch{K("점수 저장에 실패했습니다.","error")}finally{b(j,!1)}}function ae(s){const r=jt[s];return r?r.step===1?`${r.min}~${r.max} (정수)`:`${r.min}~${r.max} (${r.step}단위)`:"0~?"}var ft=tr(),yt=a(ft),Bt=a(yt);Bt.__click=()=>history.back();var se=v(Bt,2);{var ie=s=>{var r=De(),i=a(r),u=a(i),ht=a(u);e(u);var M=v(u,2),C=a(M),Z=a(C,!0);e(C);var L=v(C,2),wt=a(L,!0);e(L);var D=v(L,2),kt=a(D);e(D),e(M),e(i),e(r),I(St=>{f(ht,`#${t(g).quest_number??""} ${(t(g).title||Kt[t(g).quest_type])??""}`),f(Z,Kt[t(g).quest_type]),f(wt,t(g).quest_date),f(kt,`| 배점: ${St??""}`)},[()=>ae(t(g).quest_type)]),l(s,r)};w(se,s=>{t(g)&&s(ie)})}e(yt);var oe=v(yt,2);{var de=s=>{Ae(s,{type:"table",lines:8})},ne=s=>{var r=it(),i=U(r);{var u=M=>{var C=Ne();l(M,C)},ht=M=>{var C=Ze(),Z=U(C),L=a(Z);L.__click=()=>{b(W,"active")};var wt=a(L);e(L);var D=v(L,2);D.__click=()=>{b(W,"inactive")};var kt=a(D);e(D),e(Z);var St=v(Z,2);{var le=O=>{var tt=Ke(),et=U(tt),rt=a(et),ot=a(rt),P=v(ot);{var N=p=>{var y=Qe(),$=a(y);e(y),I(h=>f($,`| ${h??""}명 변경됨`),[()=>t(mt)()]),l(p,y)};w(P,p=>{t(mt)()>0&&p(N)})}e(rt);var at=v(rt,2),Q=a(at);Q.__click=Ut;var dt=a(Q,!0);e(Q),e(at),e(et);var nt=v(et,2);{var Y=p=>{var y=Re();l(p,y)},$t=p=>{var y=He(),$=a(y),h=a($),z=v(a(h));Gt(z,21,()=>t(S),Ht,(G,o,qt)=>{var Ft=it(),ue=U(Ft);{var _e=Mt=>{var ct=Ge(),Ot=a(ct);Ot.textContent=qt+1;var Lt=v(Ot),ve=a(Lt,!0);e(Lt);var It=v(Lt),ge=a(It);{var pe=_=>{var n=Ue();n.__click=()=>{var c,k;(c=t(d).get(t(o).legacy_student_id))!=null&&c.is_submitted&&Qt(t(o).legacy_student_id,((k=t(d).get(t(o).legacy_student_id))==null?void 0:k.score)===1?"0":"1")};var x=a(n,!0);e(n),I((c,k,T)=>{n.disabled=c,pt(n,1,`px-3 py-1 rounded text-sm font-medium transition-colors cursor-pointer disabled:opacity-40 disabled:cursor-not-allowed ${k??""}`),f(x,T)},[()=>{var c;return!((c=t(d).get(t(o).legacy_student_id))!=null&&c.is_submitted)},()=>{var c;return((c=t(d).get(t(o).legacy_student_id))==null?void 0:c.score)===1?"bg-green-100 text-green-700":"bg-red-100 text-red-700"},()=>{var c;return((c=t(d).get(t(o).legacy_student_id))==null?void 0:c.score)===1?"Pass":"Non-pass"}]),l(_,n)},be=_=>{var n=Be();Jt(n),n.__input=x=>Qt(t(o).legacy_student_id,x.target.value),I((x,c)=>{Le(n,x),n.disabled=c,Tt(n,"min",t(X).min),Tt(n,"max",t(X).max),Tt(n,"step",t(X).step)},[()=>{var x,c,k;return(x=t(d).get(t(o).legacy_student_id))!=null&&x.is_submitted&&((c=t(d).get(t(o).legacy_student_id))==null?void 0:c.score)!==null?(k=t(d).get(t(o).legacy_student_id))==null?void 0:k.score:""},()=>{var x;return!((x=t(d).get(t(o).legacy_student_id))!=null&&x.is_submitted)}]),l(_,n)};w(ge,_=>{t(g)&&t(g).quest_type==="sub"?_(pe):_(be,!1)})}e(It);var Et=v(It),Yt=a(Et),Ct=a(Yt);Jt(Ct),Ct.__change=()=>re(t(o).legacy_student_id),e(Yt),e(Et);var Pt=v(Et),me=a(Pt);{var xe=_=>{var n=Fe();l(_,n)},fe=_=>{var n=it(),x=U(n);{var c=T=>{var R=Oe();l(T,R)},k=T=>{var R=it(),_t=U(R);{var he=H=>{var J=Ye();l(H,J)},we=H=>{var J=ze();l(H,J)};w(_t,H=>{var J;(J=t(d).get(t(o).legacy_student_id))!=null&&J.is_submitted?H(we,!1):H(he)},!0)}l(T,R)};w(x,T=>{var R,_t;(R=t(d).get(t(o).legacy_student_id))!=null&&R.is_submitted&&((_t=t(d).get(t(o).legacy_student_id))==null?void 0:_t.score)!==null?T(c):T(k,!1)},!0)}l(_,n)};w(me,_=>{var n,x,c,k;t(A).get(t(o).legacy_student_id)&&(((n=t(d).get(t(o).legacy_student_id))==null?void 0:n.score)!==((x=t(A).get(t(o).legacy_student_id))==null?void 0:x.score)||((c=t(d).get(t(o).legacy_student_id))==null?void 0:c.is_submitted)!==((k=t(A).get(t(o).legacy_student_id))==null?void 0:k.is_submitted))?_(xe):_(fe,!1)})}e(Pt);var zt=v(Pt),ut=a(zt);ut.__click=()=>Rt(t(o).legacy_student_id);var ye=a(ut,!0);e(ut),e(zt),e(ct),I((_,n)=>{pt(ct,1,`border-b border-gray-100 last:border-b-0 hover:bg-gray-50/50 ${_??""}`),f(ve,t(o).student_name),Me(Ct,n),ut.disabled=t(F)===t(o).legacy_student_id,f(ye,t(F)===t(o).legacy_student_id?"처리중...":"비활성화")},[()=>{var _;return(_=t(d).get(t(o).legacy_student_id))!=null&&_.is_submitted?"":"bg-gray-50/80"},()=>{var _;return(_=t(d).get(t(o).legacy_student_id))==null?void 0:_.is_submitted}]),l(Mt,ct)};w(ue,Mt=>{t(d).get(t(o).legacy_student_id)&&Mt(_e)})}l(G,Ft)}),e(z),e(h),e($),e(y),l(p,y)};w(nt,p=>{t(S).length===0?p(Y):p($t,!1)})}var st=v(nt,2);{var lt=p=>{var y=Je(),$=a(y),h=a($),z=a(h);e(h);var G=v(h,2);G.__click=Ut;var o=a(G,!0);e(G),e($),e(y),I(qt=>{f(z,`${qt??""}명의 점수가 변경되었습니다.`),G.disabled=t(j),f(o,t(j)?"저장 중...":"변경사항 저장")},[()=>t(mt)()]),l(p,y)};w(st,p=>{t(Dt)()&&p(lt)})}I(p=>{f(ot,`총 ${t(S).length??""}명 `),Q.disabled=p,f(dt,t(j)?"저장 중...":"점수 저장")},[()=>t(j)||!t(Dt)()]),l(O,tt)},ce=O=>{var tt=it(),et=U(tt);{var rt=P=>{var N=Ve();l(P,N)},ot=P=>{var N=Xe(),at=a(N),Q=a(at),dt=v(a(Q));Gt(dt,21,()=>t(B),Ht,(nt,Y,$t)=>{var st=We(),lt=a(st);lt.textContent=$t+1;var p=v(lt),y=a(p,!0);e(p);var $=v(p),h=a($);h.__click=()=>Rt(t(Y).legacy_user_id);var z=a(h,!0);e(h),e($),e(st),I(()=>{f(y,t(Y).name),h.disabled=t(F)===t(Y).legacy_user_id,f(z,t(F)===t(Y).legacy_user_id?"처리중...":"활성화")}),l(nt,st)}),e(dt),e(Q),e(at),e(N),l(P,N)};w(et,P=>{t(B).length===0?P(rt):P(ot,!1)})}l(O,tt)};w(St,O=>{t(W)==="active"?O(le):O(ce,!1)})}I(()=>{pt(L,1,`px-4 py-2 text-sm font-medium transition-colors cursor-pointer ${t(W)==="active"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`),f(wt,`활성 학생 (${t(S).length??""})`),pt(D,1,`px-4 py-2 text-sm font-medium transition-colors cursor-pointer ${t(W)==="inactive"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`),f(kt,`비활성 학생 (${t(B).length??""})`)}),l(M,C)};w(i,M=>{t(S).length===0&&t(B).length===0?M(u):M(ht,!1)},!0)}l(s,r)};w(oe,s=>{t(bt)?s(de):s(ne,!1)})}e(ft),l(Vt,ft),$e(),te()}qe(["click","input","change"]);export{mr as component};
