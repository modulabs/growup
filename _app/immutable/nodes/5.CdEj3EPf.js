import{a as c,f as b,c as Et}from"../chunks/_V9dK3ok.js";import{o as fe}from"../chunks/1hPTKaIJ.js";import{p as ye,b as M,d as bt,a as he,c as r,e as d,g as t,s as o,r as e,h as mt,t as T,f as nt}from"../chunks/CcVkWGgp.js";import{d as we,s as m}from"../chunks/Dap9sqf4.js";import{i as k}from"../chunks/BSGnc2-w.js";import{e as Ot,i as Yt}from"../chunks/GjfVCmik.js";import{a as W,r as Gt,b as ke,c as $e,s as Tt}from"../chunks/By8uYFO7.js";import{s as lt}from"../chunks/DObsSMuQ.js";import{s as qe,a as Se}from"../chunks/Dn1l8nLM.js";import{p as Me}from"../chunks/B1YlKK7_.js";import{g as Le}from"../chunks/DUQp4yjs.js";import{b as Ie}from"../chunks/BzfUlKKA.js";import{a as P}from"../chunks/ES7LborG.js";import{i as Ee}from"../chunks/3jTL0Oy-.js";import{Q as Ht,S as jt}from"../chunks/DqiXTygU.js";import{L as Te}from"../chunks/Crjibkup.js";var je=b('<div class="flex items-center justify-between"><div><h1 class="text-2xl font-bold text-gray-800"> </h1> <div class="flex gap-2 mt-1 text-sm"><span class="px-2 py-0.5 bg-blue-50 text-blue-700 rounded"> </span> <span class="text-gray-400"> </span> <span class="text-gray-400"> </span></div></div></div>'),Pe=b('<div class="text-center py-12 text-gray-500"><p class="mb-4">학생 명단을 불러오는 중...</p> <p class="text-sm">잠시만 기다려주세요.</p></div>'),Ce=b('<span class="ml-2 text-orange-600 font-medium"> </span>'),Ne=b('<div class="p-4 text-center text-gray-500 text-sm">활성 학생이 없습니다.</div>'),De=b("<button> </button>"),Ae=b('<input type="number" class="w-20 px-2 py-1 text-center border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"/>'),Qe=b('<span class="inline-block w-2.5 h-2.5 rounded-full bg-gray-300 animate-pulse"></span>'),Re=b('<span class="inline-block w-2.5 h-2.5 rounded-full bg-green-400 hover:bg-green-500 transition-colors"></span>'),Ue=b('<tr><td class="px-4 py-2.5 text-sm text-gray-400"></td><td class="px-4 py-2.5 text-sm font-medium text-gray-800"> </td><td class="px-4 py-2.5 text-center"><!></td><td class="px-4 py-2.5 text-center"><label class="inline-flex items-center cursor-pointer"><input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer"/></label></td><td class="px-4 py-2.5 text-center"><button class="inline-block cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed" title="클릭하여 비활성화"><!></button></td></tr>'),ze=b('<div class="bg-white rounded-lg border border-gray-200 overflow-hidden"><div class="overflow-x-auto"><table class="w-full min-w-[700px]"><thead><tr class="bg-gray-50 border-b border-gray-200"><th class="text-left px-4 py-3 text-sm font-medium text-gray-600 w-12">#</th><th class="text-left px-4 py-3 text-sm font-medium text-gray-600">학생</th><th class="text-center px-4 py-3 text-sm font-medium text-gray-600 w-32">점수</th><th class="text-center px-4 py-3 text-sm font-medium text-gray-600 w-24">제출</th><th class="text-center px-4 py-3 text-sm font-medium text-gray-600 w-20">상태</th></tr></thead><tbody></tbody></table></div></div>'),Be=b('<div class="sticky bottom-2 sm:bottom-4 mt-4"><div class="bg-orange-50 border border-orange-200 rounded-lg px-4 py-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 shadow-lg"><span class="text-sm text-orange-700 font-medium"> </span> <button class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 disabled:opacity-50 transition-colors cursor-pointer"> </button></div></div>'),Fe=b('<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4"><div class="text-sm text-gray-500"> <!></div> <div class="flex gap-2"><button class="px-4 py-1.5 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors cursor-pointer"> </button></div></div> <!> <!>',1),Oe=b('<div class="p-4 text-center text-gray-500 text-sm">비활성 학생이 없습니다.</div>'),Ye=b('<span class="inline-block w-2.5 h-2.5 rounded-full bg-gray-300 animate-pulse"></span>'),Ge=b('<span class="inline-block w-2.5 h-2.5 rounded-full bg-gray-400 hover:bg-green-400 transition-colors"></span>'),He=b('<tr class="border-b border-gray-100 last:border-b-0 bg-gray-50/50"><td class="px-4 py-2.5 text-sm text-gray-400"></td><td class="px-4 py-2.5 text-sm text-gray-500"> </td><td class="px-4 py-2.5 text-center"><button class="inline-block cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed" title="클릭하여 활성화"><!></button></td></tr>'),Je=b('<div class="bg-white rounded-lg border border-gray-200 overflow-hidden"><div class="overflow-x-auto"><table class="w-full"><thead><tr class="bg-gray-50 border-b border-gray-200"><th class="text-left px-4 py-3 text-sm font-medium text-gray-600 w-12">#</th><th class="text-left px-4 py-3 text-sm font-medium text-gray-600">학생</th><th class="text-center px-4 py-3 text-sm font-medium text-gray-600 w-24">상태</th></tr></thead><tbody></tbody></table></div></div>'),Ke=b('<div class="flex border-b border-gray-200 mb-4"><button> </button> <button> </button></div> <!>',1),Ve=b('<div class="fixed inset-0 bg-black/40 z-50 flex items-center justify-center p-4"><div class="bg-white rounded-xl shadow-xl max-w-sm w-full p-6"><h3 class="text-lg font-semibold text-gray-800 mb-2"> </h3> <p class="text-sm text-gray-600 mb-1"><span class="font-medium"> </span> </p> <p class="text-xs text-gray-400 mb-5"> </p> <div class="flex gap-2 justify-end"><button class="px-4 py-2 text-sm text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors cursor-pointer">취소</button> <button> </button></div></div></div>'),We=b('<div class="max-w-4xl mx-auto px-3 py-6 sm:px-6"><div class="mb-6"><button class="text-sm text-blue-600 hover:text-blue-800 mb-2 cursor-pointer">&larr; 퀘스트 목록</button> <!></div> <!> <!></div>');function pa(Jt,Kt){ye(Kt,!0);const Vt=()=>Se(Ee,"$isLoggedIn",Wt),[Wt,Xt]=qe();let xt=M(!0),A=M(!1),p=M(null),L=M(bt([])),X=mt(()=>Me.params.questId),Pt=M(!1),Z=M("active"),O=M(bt([])),Y=M(null),y=M(null),u=M(bt(new Map)),dt=M(bt(new Map)),tt=mt(()=>t(p)?jt[t(p).quest_type]:jt.main),Ct=mt(()=>()=>{for(const[s,a]of t(u)){const i=t(dt).get(s);if(!i||a.score!==i.score||a.is_submitted!==i.is_submitted)return!0}return!1}),ft=mt(()=>()=>{let s=0;for(const[a,i]of t(u)){const n=t(dt).get(a);(!n||i.score!==n.score||i.is_submitted!==n.is_submitted)&&s++}return s});fe(async()=>{if(!Vt()){Le(`${Ie}/login`);return}await Nt()});async function Nt(){d(xt,!0);try{const[s,a]=await Promise.all([P.get(`/api/v1/facilitator/quests/${t(X)}`),P.get(`/api/v1/facilitator/quests/${t(X)}/students`)]);if(d(p,s,!0),d(L,a,!0),yt(),t(p)&&Zt(),t(L).length===0&&t(p)&&!t(Pt)){d(Pt,!0);try{await P.post(`/api/v1/admin/sync/students/${t(p).cached_course_id}`);const i=await P.get(`/api/v1/facilitator/quests/${t(X)}/students`);d(L,i,!0),yt()}catch{}}}catch{W("점수 데이터를 불러올 수 없습니다.","error")}finally{d(xt,!1)}}async function Zt(){if(t(p))try{d(O,await P.get(`/api/v1/facilitator/courses/${t(p).cached_course_id}/students?active=false`),!0)}catch{}}function yt(){const s=new Map,a=new Map;for(const i of t(L)){const n={score:i.score,is_submitted:i.is_submitted};s.set(i.legacy_student_id,{...n}),a.set(i.legacy_student_id,{...n})}d(u,s,!0),d(dt,a,!0)}function Dt(s,a){const i=t(u).get(s);if(i){if(a===""||a===null||a===void 0)i.score=null;else{const n=parseFloat(a);isNaN(n)||(i.score=Math.min(Math.max(n,t(tt).min),t(tt).max))}d(u,new Map(t(u)),!0)}}function te(s){const a=t(u).get(s);a&&(a.is_submitted=!a.is_submitted,a.is_submitted||(a.score=null),d(u,new Map(t(u)),!0))}function At(s,a,i){d(y,{studentId:s,studentName:a,action:i},!0)}async function ee(){if(!t(y)||!t(p))return;const{studentId:s}=t(y);d(y,null),d(Y,s,!0);try{const a=await P.patch(`/api/v1/facilitator/courses/${t(p).cached_course_id}/students/${s}/active`);W(a.is_active?"학생이 활성화되었습니다.":"학생이 비활성화되었습니다.","success");const[i,n]=await Promise.all([P.get(`/api/v1/facilitator/quests/${t(X)}/students`),P.get(`/api/v1/facilitator/courses/${t(p).cached_course_id}/students?active=false`)]);d(L,i,!0),d(O,n,!0),yt()}catch{W("학생 상태 변경에 실패했습니다.","error")}finally{d(Y,null)}}async function Qt(){d(A,!0);try{const s=[];for(const[a,i]of t(u)){const n=t(dt).get(a);(!n||i.score!==n.score||i.is_submitted!==n.is_submitted)&&s.push({legacy_student_id:a,score:i.is_submitted?i.score:null,is_submitted:i.is_submitted})}if(s.length===0){W("변경된 점수가 없습니다.","info"),d(A,!1);return}await P.post(`/api/v1/facilitator/quests/${t(X)}/scores`,{scores:s}),W(`${s.length}명의 점수가 저장되었습니다.`,"success"),await Nt()}catch{W("점수 저장에 실패했습니다.","error")}finally{d(A,!1)}}function ae(s){const a=jt[s];return a?a.step===1?`${a.min}~${a.max} (정수)`:`${a.min}~${a.max} (${a.step}단위)`:"0~?"}var ht=We(),wt=r(ht),Rt=r(wt);Rt.__click=()=>history.back();var re=o(Rt,2);{var se=s=>{var a=je(),i=r(a),n=r(i),et=r(n);e(n);var h=o(n,2),$=r(h),Q=r($,!0);e($);var q=o($,2),R=r(q,!0);e(q);var j=o(q,2),G=r(j);e(j),e(h),e(i),e(a),T(H=>{m(et,`#${t(p).quest_number??""} ${(t(p).title||Ht[t(p).quest_type])??""}`),m(Q,Ht[t(p).quest_type]),m(R,t(p).quest_date),m(G,`| 배점: ${H??""}`)},[()=>ae(t(p).quest_type)]),c(s,a)};k(re,s=>{t(p)&&s(se)})}e(wt);var Ut=o(wt,2);{var ie=s=>{Te(s,{type:"table",lines:8})},oe=s=>{var a=Et(),i=nt(a);{var n=h=>{var $=Pe();c(h,$)},et=h=>{var $=Ke(),Q=nt($),q=r(Q);q.__click=()=>{d(Z,"active")};var R=r(q);e(q);var j=o(q,2);j.__click=()=>{d(Z,"inactive")};var G=r(j);e(j),e(Q);var H=o(Q,2);{var J=C=>{var at=Fe(),rt=nt(at),st=r(rt),ct=r(st),N=o(ct);{var U=g=>{var f=Ce(),I=r(f);e(f),T(w=>m(I,`| ${w??""}명 변경됨`),[()=>t(ft)()]),c(g,f)};k(N,g=>{t(ft)()>0&&g(U)})}e(st);var it=o(st,2),z=r(it);z.__click=Qt;var ut=r(z,!0);e(z),e(it),e(rt);var vt=o(rt,2);{var B=g=>{var f=Ne();c(g,f)},$t=g=>{var f=ze(),I=r(f),w=r(I),K=o(r(w));Ot(K,21,()=>t(L),Yt,(D,l,E)=>{var V=Et(),de=nt(V);{var ce=qt=>{var pt=Ue(),zt=r(pt);zt.textContent=E+1;var St=o(zt),ue=r(St,!0);e(St);var Mt=o(St),ve=r(Mt);{var _e=v=>{var _=De();_.__click=()=>{var x,F;(x=t(u).get(t(l).legacy_student_id))!=null&&x.is_submitted&&Dt(t(l).legacy_student_id,((F=t(u).get(t(l).legacy_student_id))==null?void 0:F.score)===1?"0":"1")};var S=r(_,!0);e(_),T((x,F,xe)=>{_.disabled=x,lt(_,1,`px-3 py-1 rounded text-sm font-medium transition-colors cursor-pointer disabled:opacity-40 disabled:cursor-not-allowed ${F??""}`),m(S,xe)},[()=>{var x;return!((x=t(u).get(t(l).legacy_student_id))!=null&&x.is_submitted)},()=>{var x;return((x=t(u).get(t(l).legacy_student_id))==null?void 0:x.score)===1?"bg-green-100 text-green-700":"bg-red-100 text-red-700"},()=>{var x;return((x=t(u).get(t(l).legacy_student_id))==null?void 0:x.score)===1?"Pass":"Non-pass"}]),c(v,_)},pe=v=>{var _=Ae();Gt(_),_.__input=S=>Dt(t(l).legacy_student_id,S.target.value),T((S,x)=>{$e(_,S),_.disabled=x,Tt(_,"min",t(tt).min),Tt(_,"max",t(tt).max),Tt(_,"step",t(tt).step)},[()=>{var S,x,F;return(S=t(u).get(t(l).legacy_student_id))!=null&&S.is_submitted&&((x=t(u).get(t(l).legacy_student_id))==null?void 0:x.score)!==null?(F=t(u).get(t(l).legacy_student_id))==null?void 0:F.score:""},()=>{var S;return!((S=t(u).get(t(l).legacy_student_id))!=null&&S.is_submitted)}]),c(v,_)};k(ve,v=>{t(p)&&t(p).quest_type==="sub"?v(_e):v(pe,!1)})}e(Mt);var Lt=o(Mt),Bt=r(Lt),It=r(Bt);Gt(It),It.__change=()=>te(t(l).legacy_student_id),e(Bt),e(Lt);var Ft=o(Lt),gt=r(Ft);gt.__click=()=>At(t(l).legacy_student_id,t(l).student_name,"deactivate");var ge=r(gt);{var be=v=>{var _=Qe();c(v,_)},me=v=>{var _=Re();c(v,_)};k(ge,v=>{t(Y)===t(l).legacy_student_id?v(be):v(me,!1)})}e(gt),e(Ft),e(pt),T((v,_)=>{lt(pt,1,`border-b border-gray-100 last:border-b-0 hover:bg-gray-50/50 ${v??""}`),m(ue,t(l).student_name),ke(It,_),gt.disabled=t(Y)===t(l).legacy_student_id},[()=>{var v;return(v=t(u).get(t(l).legacy_student_id))!=null&&v.is_submitted?"":"bg-gray-50/80"},()=>{var v;return(v=t(u).get(t(l).legacy_student_id))==null?void 0:v.is_submitted}]),c(qt,pt)};k(de,qt=>{t(u).get(t(l).legacy_student_id)&&qt(ce)})}c(D,V)}),e(K),e(w),e(I),e(f),c(g,f)};k(vt,g=>{t(L).length===0?g(B):g($t,!1)})}var ot=o(vt,2);{var _t=g=>{var f=Be(),I=r(f),w=r(I),K=r(w);e(w);var D=o(w,2);D.__click=Qt;var l=r(D,!0);e(D),e(I),e(f),T(E=>{m(K,`${E??""}명의 점수가 변경되었습니다.`),D.disabled=t(A),m(l,t(A)?"저장 중...":"변경사항 저장")},[()=>t(ft)()]),c(g,f)};k(ot,g=>{t(Ct)()&&g(_t)})}T(g=>{m(ct,`총 ${t(L).length??""}명 `),z.disabled=g,m(ut,t(A)?"저장 중...":"점수 저장")},[()=>t(A)||!t(Ct)()]),c(C,at)},kt=C=>{var at=Et(),rt=nt(at);{var st=N=>{var U=Oe();c(N,U)},ct=N=>{var U=Je(),it=r(U),z=r(it),ut=o(r(z));Ot(ut,21,()=>t(O),Yt,(vt,B,$t)=>{var ot=He(),_t=r(ot);_t.textContent=$t+1;var g=o(_t),f=r(g,!0);e(g);var I=o(g),w=r(I);w.__click=()=>At(t(B).legacy_user_id,t(B).name,"activate");var K=r(w);{var D=E=>{var V=Ye();c(E,V)},l=E=>{var V=Ge();c(E,V)};k(K,E=>{t(Y)===t(B).legacy_user_id?E(D):E(l,!1)})}e(w),e(I),e(ot),T(()=>{m(f,t(B).name),w.disabled=t(Y)===t(B).legacy_user_id}),c(vt,ot)}),e(ut),e(z),e(it),e(U),c(N,U)};k(rt,N=>{t(O).length===0?N(st):N(ct,!1)})}c(C,at)};k(H,C=>{t(Z)==="active"?C(J):C(kt,!1)})}T(()=>{lt(q,1,`px-4 py-2 text-sm font-medium transition-colors cursor-pointer ${t(Z)==="active"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`),m(R,`활성 학생 (${t(L).length??""})`),lt(j,1,`px-4 py-2 text-sm font-medium transition-colors cursor-pointer ${t(Z)==="inactive"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`),m(G,`비활성 학생 (${t(O).length??""})`)}),c(h,$)};k(i,h=>{t(L).length===0&&t(O).length===0?h(n):h(et,!1)},!0)}c(s,a)};k(Ut,s=>{t(xt)?s(ie):s(oe,!1)})}var ne=o(Ut,2);{var le=s=>{var a=Ve();a.__click=()=>{d(y,null)};var i=r(a);i.__click=C=>C.stopPropagation();var n=r(i),et=r(n,!0);e(n);var h=o(n,2),$=r(h),Q=r($,!0);e($);var q=o($);e(h);var R=o(h,2),j=r(R,!0);e(R);var G=o(R,2),H=r(G);H.__click=()=>{d(y,null)};var J=o(H,2);J.__click=ee;var kt=r(J,!0);e(J),e(G),e(i),e(a),T(()=>{m(et,t(y).action==="deactivate"?"학생 비활성화":"학생 활성화"),m(Q,t(y).studentName),m(q,` 학생을
				${t(y).action==="deactivate"?" 비활성화":" 활성화"}하시겠습니까?`),m(j,t(y).action==="deactivate"?"비활성 학생 탭에서 언제든 다시 활성화할 수 있습니다.":"활성화하면 채점 목록에 다시 표시됩니다."),lt(J,1,`px-4 py-2 text-sm text-white rounded-lg transition-colors cursor-pointer ${t(y).action==="deactivate"?"bg-orange-500 hover:bg-orange-600":"bg-blue-600 hover:bg-blue-700"}`),m(kt,t(y).action==="deactivate"?"비활성화":"활성화")}),c(s,a)};k(ne,s=>{t(y)&&s(le)})}e(ht),c(Jt,ht),he(),Xt()}we(["click","input","change"]);export{pa as component};
