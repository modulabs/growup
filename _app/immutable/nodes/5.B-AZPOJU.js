import{a as _,f as b,c as K}from"../chunks/_V9dK3ok.js";import{o as ee}from"../chunks/1hPTKaIJ.js";import{p as se,b as j,d as ut,a as ae,c as n,e as v,g as t,s as g,r as i,h as V,t as A,f as B}from"../chunks/CcVkWGgp.js";import{d as re,s as y}from"../chunks/Dap9sqf4.js";import{i as h}from"../chunks/BSGnc2-w.js";import{e as ie,i as oe}from"../chunks/GjfVCmik.js";import{a as W,r as $t,b as ne,c as de,s as ct}from"../chunks/By8uYFO7.js";import{s as Lt}from"../chunks/DObsSMuQ.js";import{s as le,a as ue}from"../chunks/Dn1l8nLM.js";import{p as ce}from"../chunks/DSPotVMp.js";import{g as _e}from"../chunks/CJDezf0W.js";import{b as pe}from"../chunks/C7Ji4wVr.js";import{a as F}from"../chunks/BajErvzz.js";import{i as ge}from"../chunks/3jTL0Oy-.js";import{Q as Et,S as _t}from"../chunks/DqiXTygU.js";import{L as me}from"../chunks/Crjibkup.js";var ve=b('<div class="flex items-center justify-between"><div><h1 class="text-2xl font-bold text-gray-800"> </h1> <div class="flex gap-2 mt-1 text-sm"><span class="px-2 py-0.5 bg-blue-50 text-blue-700 rounded"> </span> <span class="text-gray-400"> </span> <span class="text-gray-400"> </span></div></div></div>'),be=b('<div class="text-center py-12 text-gray-500"><p class="mb-4">학생 명단을 불러오는 중...</p> <p class="text-sm">잠시만 기다려주세요.</p></div>'),fe=b('<span class="ml-2 text-orange-600 font-medium"> </span>'),xe=b("<button> </button>"),ye=b('<input type="number" class="w-20 px-2 py-1 text-center border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"/>'),he=b('<span class="inline-block w-2 h-2 rounded-full bg-orange-400" title="변경됨"></span>'),we=b('<span class="inline-block w-2 h-2 rounded-full bg-green-400" title="채점 완료"></span>'),ke=b('<span class="inline-block w-2 h-2 rounded-full bg-gray-300" title="미제출"></span>'),qe=b('<span class="inline-block w-2 h-2 rounded-full bg-yellow-400" title="미채점"></span>'),Me=b('<tr><td class="px-4 py-2.5 text-sm text-gray-400"></td><td class="px-4 py-2.5 text-sm font-medium text-gray-800"> </td><td class="px-4 py-2.5 text-center"><!></td><td class="px-4 py-2.5 text-center"><label class="inline-flex items-center cursor-pointer"><input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer"/></label></td><td class="px-4 py-2.5 text-center"><!></td></tr>'),Se=b('<div class="sticky bottom-2 sm:bottom-4 mt-4"><div class="bg-orange-50 border border-orange-200 rounded-lg px-4 py-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 shadow-lg"><span class="text-sm text-orange-700 font-medium"> </span> <button class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 disabled:opacity-50 transition-colors cursor-pointer"> </button></div></div>'),$e=b('<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4"><div class="text-sm text-gray-500"> <!></div> <div class="flex gap-2"><button class="px-3 py-1.5 text-xs border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer">전체 제출로 표시</button> <button class="px-4 py-1.5 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors cursor-pointer"> </button></div></div> <div class="bg-white rounded-lg border border-gray-200 overflow-hidden"><div class="overflow-x-auto"><table class="w-full min-w-[640px]"><thead><tr class="bg-gray-50 border-b border-gray-200"><th class="text-left px-4 py-3 text-sm font-medium text-gray-600 w-12">#</th><th class="text-left px-4 py-3 text-sm font-medium text-gray-600">학생</th><th class="text-center px-4 py-3 text-sm font-medium text-gray-600 w-32">점수</th><th class="text-center px-4 py-3 text-sm font-medium text-gray-600 w-24">제출</th><th class="text-center px-4 py-3 text-sm font-medium text-gray-600 w-20">상태</th></tr></thead><tbody></tbody></table></div></div> <!>',1),Le=b('<div class="max-w-4xl mx-auto px-3 py-6 sm:px-6"><div class="mb-6"><button class="text-sm text-blue-600 hover:text-blue-800 mb-2 cursor-pointer">&larr; 퀘스트 목록</button> <!></div> <!></div>');function ze(It,jt){se(jt,!0);const At=()=>ue(ge,"$isLoggedIn",Ct),[Ct,Dt]=le();let X=j(!0),S=j(!1),m=j(null),$=j(ut([])),O=V(()=>ce.params.questId),pt=j(!1),r=j(ut(new Map)),L=j(ut(new Map)),Q=V(()=>t(m)?_t[t(m).quest_type]:_t.main),gt=V(()=>()=>{for(const[s,e]of t(r)){const o=t(L).get(s);if(!o||e.score!==o.score||e.is_submitted!==o.is_submitted)return!0}return!1}),Z=V(()=>()=>{let s=0;for(const[e,o]of t(r)){const c=t(L).get(e);(!c||o.score!==c.score||o.is_submitted!==c.is_submitted)&&s++}return s});ee(async()=>{if(!At()){_e(`${pe}/login`);return}await mt()});async function mt(){v(X,!0);try{const[s,e]=await Promise.all([F.get(`/api/v1/facilitator/quests/${t(O)}`),F.get(`/api/v1/facilitator/quests/${t(O)}/students`)]);if(v(m,s,!0),v($,e,!0),vt(),t($).length===0&&t(m)&&!t(pt)){v(pt,!0);try{await F.post(`/api/v1/admin/sync/students/${t(m).cached_course_id}`);const o=await F.get(`/api/v1/facilitator/quests/${t(O)}/students`);v($,o,!0),vt()}catch{}}}catch{W("점수 데이터를 불러올 수 없습니다.","error")}finally{v(X,!1)}}function vt(){const s=new Map,e=new Map;for(const o of t($)){const c={score:o.score,is_submitted:o.is_submitted};s.set(o.legacy_student_id,{...c}),e.set(o.legacy_student_id,{...c})}v(r,s,!0),v(L,e,!0)}function bt(s,e){const o=t(r).get(s);if(o){if(e===""||e===null||e===void 0)o.score=null;else{const c=parseFloat(e);isNaN(c)||(o.score=Math.min(Math.max(c,t(Q).min),t(Q).max))}v(r,new Map(t(r)),!0)}}function Nt(s){const e=t(r).get(s);e&&(e.is_submitted=!e.is_submitted,e.is_submitted||(e.score=null),v(r,new Map(t(r)),!0))}function Pt(){for(const[,s]of t(r))s.is_submitted=!0;v(r,new Map(t(r)),!0)}async function ft(){v(S,!0);try{const s=[];for(const[e,o]of t(r)){const c=t(L).get(e);(!c||o.score!==c.score||o.is_submitted!==c.is_submitted)&&s.push({legacy_student_id:e,score:o.is_submitted?o.score:null,is_submitted:o.is_submitted})}if(s.length===0){W("변경된 점수가 없습니다.","info"),v(S,!1);return}await F.post(`/api/v1/facilitator/quests/${t(O)}/scores`,{scores:s}),W(`${s.length}명의 점수가 저장되었습니다.`,"success"),await mt()}catch{W("점수 저장에 실패했습니다.","error")}finally{v(S,!1)}}function Tt(s){const e=_t[s];return e?e.step===1?`${e.min}~${e.max} (정수)`:`${e.min}~${e.max} (${e.step}단위)`:"0~?"}var tt=Le(),et=n(tt),xt=n(et);xt.__click=()=>history.back();var Qt=g(xt,2);{var Rt=s=>{var e=ve(),o=n(e),c=n(o),st=n(c);i(c);var w=g(c,2),k=n(w),R=n(k,!0);i(k);var E=g(k,2),Y=n(E,!0);i(E);var z=g(E,2),at=n(z);i(z),i(w),i(o),i(e),A(G=>{y(st,`#${t(m).quest_number??""} ${(t(m).title||Et[t(m).quest_type])??""}`),y(R,Et[t(m).quest_type]),y(Y,t(m).quest_date),y(at,`| 배점: ${G??""}`)},[()=>Tt(t(m).quest_type)]),_(s,e)};h(Qt,s=>{t(m)&&s(Rt)})}i(et);var Ut=g(et,2);{var Bt=s=>{me(s,{type:"table",lines:8})},Ft=s=>{var e=K(),o=B(e);{var c=w=>{var k=be();_(w,k)},st=w=>{var k=$e(),R=B(k),E=n(R),Y=n(E),z=g(Y);{var at=x=>{var a=fe(),C=n(a);i(a),A(q=>y(C,`| ${q??""}명 변경됨`),[()=>t(Z)()]),_(x,a)};h(z,x=>{t(Z)()>0&&x(at)})}i(E);var G=g(E,2),yt=n(G);yt.__click=Pt;var H=g(yt,2);H.__click=ft;var Ot=n(H,!0);i(H),i(G),i(R);var rt=g(R,2),ht=n(rt),wt=n(ht),kt=g(n(wt));ie(kt,21,()=>t($),oe,(x,a,C)=>{var q=K(),it=B(q);{var D=U=>{var N=Me(),qt=n(N);qt.textContent=C+1;var ot=g(qt),Gt=n(ot,!0);i(ot);var nt=g(ot),Ht=n(nt);{var Jt=u=>{var d=xe();d.__click=()=>{var l,f;(l=t(r).get(t(a).legacy_student_id))!=null&&l.is_submitted&&bt(t(a).legacy_student_id,((f=t(r).get(t(a).legacy_student_id))==null?void 0:f.score)===1?"0":"1")};var p=n(d,!0);i(d),A((l,f,M)=>{d.disabled=l,Lt(d,1,`px-3 py-1 rounded text-sm font-medium transition-colors cursor-pointer disabled:opacity-40 disabled:cursor-not-allowed ${f??""}`),y(p,M)},[()=>{var l;return!((l=t(r).get(t(a).legacy_student_id))!=null&&l.is_submitted)},()=>{var l;return((l=t(r).get(t(a).legacy_student_id))==null?void 0:l.score)===1?"bg-green-100 text-green-700":"bg-red-100 text-red-700"},()=>{var l;return((l=t(r).get(t(a).legacy_student_id))==null?void 0:l.score)===1?"Pass":"Non-pass"}]),_(u,d)},Kt=u=>{var d=ye();$t(d),d.__input=p=>bt(t(a).legacy_student_id,p.target.value),A((p,l)=>{de(d,p),d.disabled=l,ct(d,"min",t(Q).min),ct(d,"max",t(Q).max),ct(d,"step",t(Q).step)},[()=>{var p,l,f;return(p=t(r).get(t(a).legacy_student_id))!=null&&p.is_submitted&&((l=t(r).get(t(a).legacy_student_id))==null?void 0:l.score)!==null?(f=t(r).get(t(a).legacy_student_id))==null?void 0:f.score:""},()=>{var p;return!((p=t(r).get(t(a).legacy_student_id))!=null&&p.is_submitted)}]),_(u,d)};h(Ht,u=>{t(m)&&t(m).quest_type==="sub"?u(Jt):u(Kt,!1)})}i(nt);var dt=g(nt),Mt=n(dt),lt=n(Mt);$t(lt),lt.__change=()=>Nt(t(a).legacy_student_id),i(Mt),i(dt);var St=g(dt),Vt=n(St);{var Wt=u=>{var d=he();_(u,d)},Xt=u=>{var d=K(),p=B(d);{var l=M=>{var I=we();_(M,I)},f=M=>{var I=K(),J=B(I);{var Zt=P=>{var T=ke();_(P,T)},te=P=>{var T=qe();_(P,T)};h(J,P=>{var T;(T=t(r).get(t(a).legacy_student_id))!=null&&T.is_submitted?P(te,!1):P(Zt)},!0)}_(M,I)};h(p,M=>{var I,J;(I=t(r).get(t(a).legacy_student_id))!=null&&I.is_submitted&&((J=t(r).get(t(a).legacy_student_id))==null?void 0:J.score)!==null?M(l):M(f,!1)},!0)}_(u,d)};h(Vt,u=>{var d,p,l,f;t(L).get(t(a).legacy_student_id)&&(((d=t(r).get(t(a).legacy_student_id))==null?void 0:d.score)!==((p=t(L).get(t(a).legacy_student_id))==null?void 0:p.score)||((l=t(r).get(t(a).legacy_student_id))==null?void 0:l.is_submitted)!==((f=t(L).get(t(a).legacy_student_id))==null?void 0:f.is_submitted))?u(Wt):u(Xt,!1)})}i(St),i(N),A((u,d)=>{Lt(N,1,`border-b border-gray-100 last:border-b-0 hover:bg-gray-50/50 ${u??""}`),y(Gt,t(a).student_name),ne(lt,d)},[()=>{var u;return(u=t(r).get(t(a).legacy_student_id))!=null&&u.is_submitted?"":"bg-gray-50/80"},()=>{var u;return(u=t(r).get(t(a).legacy_student_id))==null?void 0:u.is_submitted}]),_(U,N)};h(it,U=>{t(r).get(t(a).legacy_student_id)&&U(D)})}_(x,q)}),i(kt),i(wt),i(ht),i(rt);var Yt=g(rt,2);{var zt=x=>{var a=Se(),C=n(a),q=n(C),it=n(q);i(q);var D=g(q,2);D.__click=ft;var U=n(D,!0);i(D),i(C),i(a),A(N=>{y(it,`${N??""}명의 점수가 변경되었습니다.`),D.disabled=t(S),y(U,t(S)?"저장 중...":"변경사항 저장")},[()=>t(Z)()]),_(x,a)};h(Yt,x=>{t(gt)()&&x(zt)})}A(x=>{y(Y,`총 ${t($).length??""}명 `),H.disabled=x,y(Ot,t(S)?"저장 중...":"점수 저장")},[()=>t(S)||!t(gt)()]),_(w,k)};h(o,w=>{t($).length===0?w(c):w(st,!1)},!0)}_(s,e)};h(Ut,s=>{t(X)?s(Bt):s(Ft,!1)})}i(tt),_(It,tt),ae(),Dt()}re(["click","input","change"]);export{ze as component};
