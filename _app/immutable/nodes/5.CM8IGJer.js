import{a as l,f as p,c as tt}from"../chunks/DFT1ytgf.js";import{o as be}from"../chunks/DMfMPnKQ.js";import{p as xe,b as S,d as lt,a as fe,c as r,e as x,g as t,s as g,r as a,h as ct,t as $,f as R,n as ye}from"../chunks/BEQsxIvx.js";import{d as he,s as y}from"../chunks/CgrAqejC.js";import{i as h}from"../chunks/ydWyYzkG.js";import{e as Ft,i as Ot}from"../chunks/Dcpt7984.js";import{a as ut,r as Yt,b as we,c as ke,s as Et}from"../chunks/DeTyjmey.js";import{s as _t}from"../chunks/BX8xLHbN.js";import{s as qe,a as Me}from"../chunks/DNTsbMmy.js";import{p as Se}from"../chunks/BgRyir27.js";import{g as $e}from"../chunks/BuFRQz0i.js";import{b as Le}from"../chunks/C1g_sjku.js";import{a as Y}from"../chunks/BcmWSpjV.js";import{i as Ee}from"../chunks/5onMDv81.js";import{Q as zt,S as It}from"../chunks/DqiXTygU.js";import{L as Ie}from"../chunks/BEasMuwi.js";var Ce=p('<div class="flex items-center justify-between"><div><h1 class="text-2xl font-bold text-gray-800"> </h1> <div class="flex gap-2 mt-1 text-sm"><span class="px-2 py-0.5 bg-blue-50 text-blue-700 rounded"> </span> <span class="text-gray-400"> </span> <span class="text-gray-400"> </span></div></div></div>'),Te=p('<div class="text-center py-12 text-gray-500"><p class="mb-4">학생 명단을 불러오는 중...</p> <p class="text-sm">잠시만 기다려주세요.</p></div>'),je=p('<span class="ml-2 text-orange-600 font-medium"> </span>'),De=p('<div class="p-4 text-center text-gray-500 text-sm">활성 학생이 없습니다.</div>'),Ne=p("<button> </button>"),Pe=p('<input type="number" class="w-20 px-2 py-1 text-center border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed"/>'),Ae=p('<span class="inline-block w-2 h-2 rounded-full bg-orange-400" title="변경됨"></span>'),Qe=p('<span class="inline-block w-2 h-2 rounded-full bg-green-400" title="채점 완료"></span>'),Re=p('<span class="inline-block w-2 h-2 rounded-full bg-gray-300" title="미제출"></span>'),Ue=p('<span class="inline-block w-2 h-2 rounded-full bg-yellow-400" title="미채점"></span>'),Be=p('<tr><td class="px-4 py-2.5 text-sm text-gray-400"></td><td class="px-4 py-2.5 text-sm font-medium text-gray-800"> </td><td class="px-4 py-2.5 text-center"><!></td><td class="px-4 py-2.5 text-center"><label class="inline-flex items-center cursor-pointer"><input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer"/></label></td><td class="px-4 py-2.5 text-center"><!></td></tr>'),Fe=p('<div class="bg-white rounded-lg border border-gray-200 overflow-hidden"><div class="overflow-x-auto"><table class="w-full min-w-[640px]"><thead><tr class="bg-gray-50 border-b border-gray-200"><th class="text-left px-4 py-3 text-sm font-medium text-gray-600 w-12">#</th><th class="text-left px-4 py-3 text-sm font-medium text-gray-600">학생</th><th class="text-center px-4 py-3 text-sm font-medium text-gray-600 w-32">점수</th><th class="text-center px-4 py-3 text-sm font-medium text-gray-600 w-24">제출</th><th class="text-center px-4 py-3 text-sm font-medium text-gray-600 w-20">상태</th></tr></thead><tbody></tbody></table></div></div>'),Oe=p('<div class="sticky bottom-2 sm:bottom-4 mt-4"><div class="bg-orange-50 border border-orange-200 rounded-lg px-4 py-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 shadow-lg"><span class="text-sm text-orange-700 font-medium"> </span> <button class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 disabled:opacity-50 transition-colors cursor-pointer"> </button></div></div>'),Ye=p('<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4"><div class="text-sm text-gray-500"> <!></div> <div class="flex gap-2"><button class="px-4 py-1.5 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors cursor-pointer"> </button></div></div> <!> <!>',1),ze=p('<div class="p-4 text-center text-gray-500 text-sm">비활성 학생이 없습니다.</div>'),Ge=p('<tr class="border-b border-gray-100 last:border-b-0 bg-gray-50/50"><td class="px-4 py-2.5 text-sm text-gray-400"></td><td class="px-4 py-2.5 text-sm text-gray-500"> </td><td class="px-4 py-2.5 text-center"><span class="text-xs text-gray-400">비활성</span></td></tr>'),He=p('<div class="bg-white rounded-lg border border-gray-200 overflow-hidden"><div class="overflow-x-auto"><table class="w-full"><thead><tr class="bg-gray-50 border-b border-gray-200"><th class="text-left px-4 py-3 text-sm font-medium text-gray-600 w-12">#</th><th class="text-left px-4 py-3 text-sm font-medium text-gray-600">학생</th><th class="text-center px-4 py-3 text-sm font-medium text-gray-600 w-24">상태</th></tr></thead><tbody></tbody></table></div></div>'),Je=p('<div class="flex border-b border-gray-200 mb-4"><button> </button> <button> </button></div> <!>',1),Ke=p('<div class="max-w-4xl mx-auto px-3 py-6 sm:px-6"><div class="mb-6"><button class="text-sm text-blue-600 hover:text-blue-800 mb-2 cursor-pointer">&larr; 퀘스트 목록</button> <!></div> <!></div>');function _a(Gt,Ht){xe(Ht,!0);const Jt=()=>Me(Ee,"$isLoggedIn",Kt),[Kt,Vt]=qe();let vt=S(!0),T=S(!1),m=S(null),k=S(lt([])),et=ct(()=>Se.params.questId),Ct=S(!1),z=S("active"),G=S(lt([])),o=S(lt(new Map)),j=S(lt(new Map)),H=ct(()=>t(m)?It[t(m).quest_type]:It.main),Tt=ct(()=>()=>{for(const[s,e]of t(o)){const i=t(j).get(s);if(!i||e.score!==i.score||e.is_submitted!==i.is_submitted)return!0}return!1}),gt=ct(()=>()=>{let s=0;for(const[e,i]of t(o)){const _=t(j).get(e);(!_||i.score!==_.score||i.is_submitted!==_.is_submitted)&&s++}return s});be(async()=>{if(!Jt()){$e(`${Le}/login`);return}await jt()});async function jt(){x(vt,!0);try{const[s,e]=await Promise.all([Y.get(`/api/v1/facilitator/quests/${t(et)}`),Y.get(`/api/v1/facilitator/quests/${t(et)}/students`)]);if(x(m,s,!0),x(k,e,!0),Dt(),t(m)&&Y.get(`/api/v1/facilitator/courses/${t(m).cached_course_id}/students?active=false`).then(i=>{x(G,i,!0)}).catch(()=>{}),t(k).length===0&&t(m)&&!t(Ct)){x(Ct,!0);try{await Y.post(`/api/v1/admin/sync/students/${t(m).cached_course_id}`);const i=await Y.get(`/api/v1/facilitator/quests/${t(et)}/students`);x(k,i,!0),Dt()}catch{}}}catch{ut("점수 데이터를 불러올 수 없습니다.","error")}finally{x(vt,!1)}}function Dt(){const s=new Map,e=new Map;for(const i of t(k)){const _={score:i.score,is_submitted:i.is_submitted};s.set(i.legacy_student_id,{..._}),e.set(i.legacy_student_id,{..._})}x(o,s,!0),x(j,e,!0)}function Nt(s,e){const i=t(o).get(s);if(i){if(e===""||e===null||e===void 0)i.score=null;else{const _=parseFloat(e);isNaN(_)||(i.score=Math.min(Math.max(_,t(H).min),t(H).max))}x(o,new Map(t(o)),!0)}}function Wt(s){const e=t(o).get(s);e&&(e.is_submitted=!e.is_submitted,e.is_submitted||(e.score=null),x(o,new Map(t(o)),!0))}async function Pt(){x(T,!0);try{const s=[];for(const[e,i]of t(o)){const _=t(j).get(e);(!_||i.score!==_.score||i.is_submitted!==_.is_submitted)&&s.push({legacy_student_id:e,score:i.is_submitted?i.score:null,is_submitted:i.is_submitted})}if(s.length===0){ut("변경된 점수가 없습니다.","info"),x(T,!1);return}await Y.post(`/api/v1/facilitator/quests/${t(et)}/scores`,{scores:s}),ut(`${s.length}명의 점수가 저장되었습니다.`,"success"),await jt()}catch{ut("점수 저장에 실패했습니다.","error")}finally{x(T,!1)}}function Xt(s){const e=It[s];return e?e.step===1?`${e.min}~${e.max} (정수)`:`${e.min}~${e.max} (${e.step}단위)`:"0~?"}var pt=Ke(),mt=r(pt),At=r(mt);At.__click=()=>history.back();var Zt=g(At,2);{var te=s=>{var e=Ce(),i=r(e),_=r(i),bt=r(_);a(_);var q=g(_,2),L=r(q),J=r(L,!0);a(L);var M=g(L,2),xt=r(M,!0);a(M);var D=g(M,2),ft=r(D);a(D),a(q),a(i),a(e),$(yt=>{y(bt,`#${t(m).quest_number??""} ${(t(m).title||zt[t(m).quest_type])??""}`),y(J,zt[t(m).quest_type]),y(xt,t(m).quest_date),y(ft,`| 배점: ${yt??""}`)},[()=>Xt(t(m).quest_type)]),l(s,e)};h(Zt,s=>{t(m)&&s(te)})}a(mt);var ee=g(mt,2);{var ae=s=>{Ie(s,{type:"table",lines:8})},re=s=>{var e=tt(),i=R(e);{var _=q=>{var L=Te();l(q,L)},bt=q=>{var L=Je(),J=R(L),M=r(J);M.__click=()=>{x(z,"active")};var xt=r(M);a(M);var D=g(M,2);D.__click=()=>{x(z,"inactive")};var ft=r(D);a(D),a(J);var yt=g(J,2);{var se=U=>{var K=Ye(),V=R(K),W=r(V),at=r(W),E=g(at);{var N=v=>{var f=je(),A=r(f);a(f),$(I=>y(A,`| ${I??""}명 변경됨`),[()=>t(gt)()]),l(v,f)};h(E,v=>{t(gt)()>0&&v(N)})}a(W);var X=g(W,2),P=r(X);P.__click=Pt;var rt=r(P,!0);a(P),a(X),a(V);var st=g(V,2);{var ht=v=>{var f=De();l(v,f)},wt=v=>{var f=Fe(),A=r(f),I=r(A),ot=g(r(I));Ft(ot,21,()=>t(k),Ot,(B,n,kt)=>{var Qt=tt(),oe=R(Qt);{var ne=qt=>{var nt=Be(),Rt=r(nt);Rt.textContent=kt+1;var Mt=g(Rt),de=r(Mt,!0);a(Mt);var St=g(Mt),le=r(St);{var ce=u=>{var d=Ne();d.__click=()=>{var c,w;(c=t(o).get(t(n).legacy_student_id))!=null&&c.is_submitted&&Nt(t(n).legacy_student_id,((w=t(o).get(t(n).legacy_student_id))==null?void 0:w.score)===1?"0":"1")};var b=r(d,!0);a(d),$((c,w,C)=>{d.disabled=c,_t(d,1,`px-3 py-1 rounded text-sm font-medium transition-colors cursor-pointer disabled:opacity-40 disabled:cursor-not-allowed ${w??""}`),y(b,C)},[()=>{var c;return!((c=t(o).get(t(n).legacy_student_id))!=null&&c.is_submitted)},()=>{var c;return((c=t(o).get(t(n).legacy_student_id))==null?void 0:c.score)===1?"bg-green-100 text-green-700":"bg-red-100 text-red-700"},()=>{var c;return((c=t(o).get(t(n).legacy_student_id))==null?void 0:c.score)===1?"Pass":"Non-pass"}]),l(u,d)},ue=u=>{var d=Pe();Yt(d),d.__input=b=>Nt(t(n).legacy_student_id,b.target.value),$((b,c)=>{ke(d,b),d.disabled=c,Et(d,"min",t(H).min),Et(d,"max",t(H).max),Et(d,"step",t(H).step)},[()=>{var b,c,w;return(b=t(o).get(t(n).legacy_student_id))!=null&&b.is_submitted&&((c=t(o).get(t(n).legacy_student_id))==null?void 0:c.score)!==null?(w=t(o).get(t(n).legacy_student_id))==null?void 0:w.score:""},()=>{var b;return!((b=t(o).get(t(n).legacy_student_id))!=null&&b.is_submitted)}]),l(u,d)};h(le,u=>{t(m)&&t(m).quest_type==="sub"?u(ce):u(ue,!1)})}a(St);var $t=g(St),Ut=r($t),Lt=r(Ut);Yt(Lt),Lt.__change=()=>Wt(t(n).legacy_student_id),a(Ut),a($t);var Bt=g($t),_e=r(Bt);{var ve=u=>{var d=Ae();l(u,d)},ge=u=>{var d=tt(),b=R(d);{var c=C=>{var Q=Qe();l(C,Q)},w=C=>{var Q=tt(),dt=R(Q);{var pe=F=>{var O=Re();l(F,O)},me=F=>{var O=Ue();l(F,O)};h(dt,F=>{var O;(O=t(o).get(t(n).legacy_student_id))!=null&&O.is_submitted?F(me,!1):F(pe)},!0)}l(C,Q)};h(b,C=>{var Q,dt;(Q=t(o).get(t(n).legacy_student_id))!=null&&Q.is_submitted&&((dt=t(o).get(t(n).legacy_student_id))==null?void 0:dt.score)!==null?C(c):C(w,!1)},!0)}l(u,d)};h(_e,u=>{var d,b,c,w;t(j).get(t(n).legacy_student_id)&&(((d=t(o).get(t(n).legacy_student_id))==null?void 0:d.score)!==((b=t(j).get(t(n).legacy_student_id))==null?void 0:b.score)||((c=t(o).get(t(n).legacy_student_id))==null?void 0:c.is_submitted)!==((w=t(j).get(t(n).legacy_student_id))==null?void 0:w.is_submitted))?u(ve):u(ge,!1)})}a(Bt),a(nt),$((u,d)=>{_t(nt,1,`border-b border-gray-100 last:border-b-0 hover:bg-gray-50/50 ${u??""}`),y(de,t(n).student_name),we(Lt,d)},[()=>{var u;return(u=t(o).get(t(n).legacy_student_id))!=null&&u.is_submitted?"":"bg-gray-50/80"},()=>{var u;return(u=t(o).get(t(n).legacy_student_id))==null?void 0:u.is_submitted}]),l(qt,nt)};h(oe,qt=>{t(o).get(t(n).legacy_student_id)&&qt(ne)})}l(B,Qt)}),a(ot),a(I),a(A),a(f),l(v,f)};h(st,v=>{t(k).length===0?v(ht):v(wt,!1)})}var Z=g(st,2);{var it=v=>{var f=Oe(),A=r(f),I=r(A),ot=r(I);a(I);var B=g(I,2);B.__click=Pt;var n=r(B,!0);a(B),a(A),a(f),$(kt=>{y(ot,`${kt??""}명의 점수가 변경되었습니다.`),B.disabled=t(T),y(n,t(T)?"저장 중...":"변경사항 저장")},[()=>t(gt)()]),l(v,f)};h(Z,v=>{t(Tt)()&&v(it)})}$(v=>{y(at,`총 ${t(k).length??""}명 `),P.disabled=v,y(rt,t(T)?"저장 중...":"점수 저장")},[()=>t(T)||!t(Tt)()]),l(U,K)},ie=U=>{var K=tt(),V=R(K);{var W=E=>{var N=ze();l(E,N)},at=E=>{var N=He(),X=r(N),P=r(X),rt=g(r(P));Ft(rt,21,()=>t(G),Ot,(st,ht,wt)=>{var Z=Ge(),it=r(Z);it.textContent=wt+1;var v=g(it),f=r(v,!0);a(v),ye(),a(Z),$(()=>y(f,t(ht).name)),l(st,Z)}),a(rt),a(P),a(X),a(N),l(E,N)};h(V,E=>{t(G).length===0?E(W):E(at,!1)})}l(U,K)};h(yt,U=>{t(z)==="active"?U(se):U(ie,!1)})}$(()=>{_t(M,1,`px-4 py-2 text-sm font-medium transition-colors cursor-pointer ${t(z)==="active"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`),y(xt,`활성 학생 (${t(k).length??""})`),_t(D,1,`px-4 py-2 text-sm font-medium transition-colors cursor-pointer ${t(z)==="inactive"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`),y(ft,`비활성 학생 (${t(G).length??""})`)}),l(q,L)};h(i,q=>{t(k).length===0&&t(G).length===0?q(_):q(bt,!1)},!0)}l(s,e)};h(ee,s=>{t(vt)?s(ae):s(re,!1)})}a(pt),l(Gt,pt),fe(),Vt()}he(["click","input","change"]);export{_a as component};
